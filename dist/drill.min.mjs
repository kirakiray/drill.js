//! drill.js - v5.3.11 https://github.com/kirakiray/drill.js  (c) 2018-2024 YAO
const t="https://ofajs.github.io/ofa-errors/errors",e={};if(globalThis.navigator&&navigator.language){let a=navigator.language.toLowerCase().split("-")[0];"zh"===a&&"zh-cn"!==navigator.language.toLowerCase()&&(a="zhft"),(async()=>{if(localStorage["ofa-errors"]){const t=JSON.parse(localStorage["ofa-errors"]);Object.assign(e,t)}const s=localStorage["ofa-errors-time"];if(!s||Date.now()>Number(s)+3e5){const s=await fetch(`${t}/${a}.json`).then((t=>t.json())).catch((()=>null));s?(localStorage["ofa-errors"]=JSON.stringify(s),localStorage["ofa-errors-time"]=Date.now()):s=await fetch(`${t}/en.json`).then((t=>t.json())).catch((t=>(console.error(t),null))),Object.assign(e,s)}})()}let a=!1;globalThis.navigator&&(a=navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome"));const s=(t,e,s)=>{let r,o=n(t,e);return s?(a&&(o+=`\nCaused by: ${s.toString()}\n  ${s.stack.replace(/\n/g,"\n    ")}`),r=new Error(o,{cause:s})):r=new Error(o),r.code=t,r},n=(t,a)=>{if(!e[t])return`Error code: "${t}", please go to https://github.com/ofajs/ofa-errors to view the corresponding error information`;let s=e[t];if(a)for(let t in a)s=s.replace(new RegExp(`{${t}}`,"g"),a[t]);return s};class r{constructor(){this._middlewares=new Map}use(t){const e=Math.random().toString(32).slice(2);return this._middlewares.set(e,t),e}unuse(t){return this._middlewares.delete(t)}async run(t){let e=-1;const a=Array.from(this._middlewares.values()),s=async()=>{e++,e<a.length&&await a[e](t,s)};await s()}}const o=t=>/^blob:/.test(t)||/^data:/.test(t),i=new Map,l=async(t,e)=>{let a=t;if(!o(t)){const s=new URL(t);a=e.includes("-direct")?t:`${s.origin}${s.pathname}`}let s=i.get(a);s||(s=fetch(a),i.set(a,s));return(await s).clone()},c={},u=(t,e)=>{(c[t]||(c[t]=new r)).use(e)},h=(t,e)=>{t instanceof Function&&(e=t,t=["js","mjs"]),t instanceof Array?t.forEach((t=>{u(t,e)})):u(t,e)};h(["mjs","js"],(async(t,e)=>{if(!t.result){const{url:e,params:a}=t,n=new URL(e),r=o(e);try{r||a.includes("-direct")?t.result=await import(e):t.result=await import(`${n.origin}${n.pathname}`)}catch(a){const n=s("load_module",{url:t.realUrl||e},a);throw r&&console.warn(n,t),n}}await e()})),h(["txt","html","htm"],(async(t,e)=>{if(!t.result){const{url:e,params:a}=t;let n;try{n=await l(e,a)}catch(t){throw s("load_fail",{url:e},t)}if(!/^2.{2}$/.test(n.status))throw s("load_fail_status",{url:e,status:n.status});t.result=await n.text()}await e()})),h("json",(async(t,e)=>{if(!t.result){const{url:e,params:a}=t;t.result=await l(e,a).then((t=>t.json()))}await e()})),h("wasm",(async(t,e)=>{if(!t.result){const{url:e,params:a}=t,s=await l(e,a).then((t=>t.arrayBuffer())),n=await WebAssembly.compile(s),r=new WebAssembly.Instance(n);t.result=r.exports}await e()})),h("css",(async(t,e)=>{if(!t.result){const{url:e,element:a,params:s}=t;if(a){const t=document.createElement("link");t.rel="stylesheet",t.href=e;const s=a.getRootNode();let n;s===document?s.head.append(t):s.appendChild(t),a.addEventListener("disconnected",n=e=>{t.remove(),a.removeEventListener("disconnected",n)})}else t.result=await l(e,s).then((t=>t.text()))}await e()}));const d={};const f=(t,e)=>{if(t.startsWith("http://")||t.startsWith("https://"))return t;const[a,...n]=t.split(" ");let r=a;if(/^@/.test(a)){const[e,...n]=a.split("/");if(!d[e])throw s("no_alias",{name:e,url:t});r=[d[e].replace(/\/$/,""),...n].join("/")}if("undefined"!=typeof location){const t=e?new URL(e,location.href):location.href;r=new URL(r,t).href}return n.length?`${r} ${n.join(" ")}`:r},m=Symbol("loaded"),p=async(t,e)=>{const a=new URL(t),{pathname:s}=a;let n,r=null;e.params&&e.params.forEach((t=>{/^\..+/.test(t)?n=t.replace(/^\.(.+)/,"$1"):/^\-\-real/.test(t)&&(r=t.replace(/^\-\-real\:/,""))})),n||(n=s.slice(2+(s.lastIndexOf(".")-1>>>0)));const o={url:t,result:null,realUrl:r,...e},i=c[n];if(i)await i.run(o);else{const e=await fetch(t),a=e.headers.get("Content-Type"),s=[["application/javascript","js"],["application/json","json"],["text/html","html"],["text/xml","xml"]].find((t=>a.includes(t[0])));let n;s&&(n=c[s[1]]),n?await n.run(o):o.result=e}if(e&&e.element){const{element:t}=e;t[m]=!0;const a=new Event("load");t.dispatchEvent(a)}return e.params&&e.params.includes("-ctx")?o:o.result};function w(t,e){return((t,e)=>(t||(t={url:document.location.href}),a=>{let[s,...n]=a.split(" ");const r=f(s,t.url);return p(r,{params:n,...e})}))(t,e)}Object.defineProperties(w,{use:{value:h},alias:{get:()=>({...d})}});class g extends HTMLElement{constructor(...t){super(...t),this[m]=!1,Object.defineProperties(this,{loaded:{get:()=>this[m]}}),this._init()}_init(){if(this.__initSrc||this.attributes.hasOwnProperty("pause"))return;let t=this.getAttribute("src");if(!t)return;this.__initSrc=t;lm(void 0,{element:this})(t),Object.defineProperties(this,{src:{configurable:!0,value:t}})}connectedCallback(){const t=new CustomEvent("connected");t.root=this._root=this.getRootNode(),this.dispatchEvent(t)}disconnectedCallback(){const t=new CustomEvent("disconnected");t.root=this._root,delete this._root,this.dispatchEvent(t)}attributeChangedCallback(t,e,a){if("src"===t){if(a&&null===e)this._init();else if(this.__initSrc&&e&&a!==this.__initSrc)throw this.setAttribute("src",this.__initSrc),s("change_lm_src",{tag:this.tagName.toLowerCase()})}else"pause"===t&&null===a&&this._init()}static get observedAttributes(){return["src","pause"]}}class _ extends g{constructor(...t){super(...t)}}const b=()=>{customElements.define("load-module",g),customElements.define("l-m",_),window.removeEventListener("load",b)};"complete"===document.readyState?b():window.addEventListener("load",b),w.config=async function(t){const{alias:e}=t;return e&&Object.entries(e).forEach((([t,e])=>{if(!/^@.+/.test(t))throw s("config_alias_name_error",{name:t});if(d[t])throw s("alias_already",{name:t});if(/^\./.test(e))throw s("alias_relate_name",{name:t,path:e});d[t]=e})),!0},w.path=f,Object.freeze(w),window.lm=w;export{w as default};
//# sourceMappingURL=drill.min.mjs.map
