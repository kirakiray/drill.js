//! drill.js - v5.3.8 https://github.com/kirakiray/drill.js  (c) 2018-2024 YAO
const t={};fetch(`http://127.0.0.1:5793/errors/${navigator.language.toLowerCase()}.json`).catch((()=>fetch("default.json"))).then((t=>t.json())).then((e=>{Object.assign(t,e)}));const e=(t,e,n)=>{const r=s(t,e);let a;return a=n?new Error(r,{cause:n}):new Error(r),a},s=(e,s)=>{if(!t[e])return`Error code: "${e}", please go to https://github.com/ofajs/ofa-errors to view the corresponding error information`;let n=t[e];if(s)for(let t in s)n=n.replace(new RegExp(`{${t}}`,"g"),s[t]);return n};class n{constructor(){this._middlewares=new Map}use(t){const e=Math.random().toString(32).slice(2);return this._middlewares.set(e,t),e}unuse(t){return this._middlewares.delete(t)}async run(t){let e=-1;const s=Array.from(this._middlewares.values()),n=async()=>{e++,e<s.length&&await s[e](t,n)};await n()}}const r=new Map,a=async(t,e)=>{const s=new URL(t),n=e.includes("-direct")?t:`${s.origin}${s.pathname}`;let a=r.get(n);a||(a=fetch(n),r.set(n,a));return(await a).clone()},i={},o=(t,e)=>{(i[t]||(i[t]=new n)).use(e)},l=(t,e)=>{t instanceof Function&&(e=t,t=["js","mjs"]),t instanceof Array?t.forEach((t=>{o(t,e)})):o(t,e)};l(["mjs","js"],(async(t,s)=>{if(!t.result){const{url:s,params:n}=t,r=new URL(s),a=/^blob:/.test(s)||/^data:/.test(s);try{a||n.includes("-direct")?t.result=await import(s):t.result=await import(`${r.origin}${r.pathname}`)}catch(n){const r=e("load_module",{url:t.realUrl||s},n);throw a&&console.log("load failed:",t.realUrl||s," ctx:",t),r}}await s()})),l(["txt","html","htm"],(async(t,s)=>{if(!t.result){const{url:s,params:n}=t;let r;try{r=await a(s,n)}catch(t){throw e("load_fail",{url:s},t)}if(!/^2.{2}$/.test(r.status))throw e("load_fail_status",{url:s,status:r.status});t.result=await r.text()}await s()})),l("json",(async(t,e)=>{if(!t.result){const{url:e,params:s}=t;t.result=await a(e,s).then((t=>t.json()))}await e()})),l("wasm",(async(t,e)=>{if(!t.result){const{url:e,params:s}=t,n=await a(e,s).then((t=>t.arrayBuffer())),r=await WebAssembly.compile(n),i=new WebAssembly.Instance(r);t.result=i.exports}await e()})),l("css",(async(t,e)=>{if(!t.result){const{url:e,element:s,params:n}=t;if(s){const t=document.createElement("link");t.rel="stylesheet",t.href=e;const n=s.getRootNode();let r;n===document?n.head.append(t):n.appendChild(t),s.addEventListener("disconnected",r=e=>{t.remove(),s.removeEventListener("disconnected",r)})}else t.result=await a(e,n).then((t=>t.text()))}await e()}));const c={};const u=(t,s)=>{if(t.startsWith("http://")||t.startsWith("https://"))return t;const[n,...r]=t.split(" ");let a=n;if(/^@/.test(n)){const[s,...r]=n.split("/");if(!c[s])throw e("no_alias",{name:s,url:t});a=[c[s].replace(/\/$/,""),...r].join("/")}if("undefined"!=typeof location){const t=s?new URL(s,location.href):location.href;a=new URL(a,t).href}return r.length?`${a} ${r.join(" ")}`:a},d=Symbol("loaded"),h=async(t,e)=>{const s=new URL(t),{pathname:n}=s;let r,a=null;e.params&&e.params.forEach((t=>{/^\..+/.test(t)?r=t.replace(/^\.(.+)/,"$1"):/^\-\-real/.test(t)&&(a=t.replace(/^\-\-real\:/,""))})),r||(r=n.slice(2+(n.lastIndexOf(".")-1>>>0)));const o={url:t,result:null,realUrl:a,...e},l=i[r];if(l)await l.run(o);else{const e=await fetch(t),s=e.headers.get("Content-Type"),n=[["application/javascript","js"],["application/json","json"],["text/html","html"],["text/xml","xml"]].find((t=>s.includes(t[0])));let r;n&&(r=i[n[1]]),r?await r.run(o):o.result=e}if(e&&e.element){const{element:t}=e;t[d]=!0;const s=new Event("load");t.dispatchEvent(s)}return e.params&&e.params.includes("-ctx")?o:o.result};function m(t,e){return((t,e)=>(t||(t={url:document.location.href}),s=>{let[n,...r]=s.split(" ");const a=u(n,t.url);return h(a,{params:r,...e})}))(t,e)}Object.defineProperties(m,{use:{value:l},alias:{get:()=>({...c})}});class f extends HTMLElement{constructor(...t){super(...t),this[d]=!1,Object.defineProperties(this,{loaded:{get:()=>this[d]}}),this._init()}_init(){if(this.__initSrc||this.attributes.hasOwnProperty("pause"))return;let t=this.getAttribute("src");if(!t)return;this.__initSrc=t;lm(void 0,{element:this})(t),Object.defineProperties(this,{src:{configurable:!0,value:t}})}connectedCallback(){const t=new CustomEvent("connected");t.root=this._root=this.getRootNode(),this.dispatchEvent(t)}disconnectedCallback(){const t=new CustomEvent("disconnected");t.root=this._root,delete this._root,this.dispatchEvent(t)}attributeChangedCallback(t,e,s){"src"===t?s&&null===e?this._init():this.__initSrc&&e&&s!==this.__initSrc&&(console.warn(`${this.tagName.toLowerCase()} change src is invalid, only the first change will be loaded`),this.setAttribute("src",this.__initSrc)):"pause"===t&&null===s&&this._init()}static get observedAttributes(){return["src","pause"]}}class p extends f{constructor(...t){super(...t)}}const w=()=>{customElements.define("load-module",f),customElements.define("l-m",p),window.removeEventListener("load",w)};"complete"===document.readyState?w():window.addEventListener("load",w),m.config=async function(t){const{alias:s}=t;return s&&Object.entries(s).forEach((([t,s])=>{if(!/^@.+/.test(t))throw e("config_alias_name_error",{name:t});if(c[t])throw new Error(`Alias already exists: '${t}'`);if(/^\./.test(s))throw new Error(`The address does not match the specification, please use '/' or or the beginning of the protocol: '${s}'`);c[t]=s})),!0},m.path=u,Object.freeze(m),window.lm=m;export{m as default};
//# sourceMappingURL=drill.min.mjs.map
