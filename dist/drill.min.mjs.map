{"version":3,"file":"drill.min.mjs","sources":["../src/use.mjs","../src/main.mjs","../src/component.mjs","../src/base.mjs"],"sourcesContent":["export const processor = {};\n\nexport const use = (name, handler) => {\n  if (name instanceof Function) {\n    handler = name;\n    name = [\"js\", \"mjs\"];\n  }\n\n  if (name instanceof Array) {\n    name.forEach((name) => {\n      const tasks = processor[name] || (processor[name] = []);\n      tasks.push(handler);\n    });\n    return;\n  }\n\n  const tasks = processor[name] || (processor[name] = []);\n  tasks.push(handler);\n};\n\nuse([\"mjs\", \"js\"], ({ url, params }) => {\n  const d = new URL(url);\n  if (params.includes(\"-direct\")) {\n    return import(url);\n  }\n  return import(`${d.origin}${d.pathname}`);\n});\n\nuse([\"txt\", \"html\"], ({ url }) => {\n  return fetch(url).then((e) => e.text());\n});\n\nuse(\"json\", async ({ url }) => {\n  return fetch(url).then((e) => e.json());\n});\n\nuse(\"wasm\", async ({ url }) => {\n  const data = await fetch(url).then((e) => e.arrayBuffer());\n\n  const module = await WebAssembly.compile(data);\n  const instance = new WebAssembly.Instance(module);\n\n  return instance.exports;\n});\n","import { processor, use } from \"./use.mjs\";\nexport const LOADED = Symbol(\"loaded\");\n\nconst createLoad = (meta) => {\n  if (!meta) {\n    meta = {\n      url: document.location.href,\n    };\n  }\n  const load = (ourl) => {\n    let reurl = \"\";\n    const [url, ...params] = ourl.split(\" \");\n\n    if (meta.resolve) {\n      reurl = meta.resolve(url);\n    } else {\n      const currentUrl = new URL(meta.url);\n      const resolvedUrl = new URL(url, currentUrl);\n      reurl = resolvedUrl.href;\n    }\n\n    return agent(reurl, { params });\n  };\n  return load;\n};\n\nexport const agent = async (url, opts) => {\n  const urldata = new URL(url);\n  const { pathname } = urldata;\n\n  const type = pathname.slice(((pathname.lastIndexOf(\".\") - 1) >>> 0) + 2);\n\n  let data;\n\n  const tasks = processor[type];\n\n  if (tasks) {\n    for (let f of tasks) {\n      const temp = await f({\n        url,\n        data,\n        ...opts,\n      });\n\n      temp !== undefined && (data = temp);\n    }\n  } else {\n    data = fetch(url);\n  }\n\n  if (opts && opts.element) {\n    const { element } = opts;\n    element[LOADED] = true;\n    const event = new Event(\"load\");\n    element.dispatchEvent(event);\n  }\n\n  return data;\n};\n\nexport default function lm(meta) {\n  return createLoad(meta);\n}\n\nObject.assign(lm, {\n  use,\n});\n","import { agent, LOADED } from \"./main.mjs\";\n\nclass LoadModule extends HTMLElement {\n  constructor(...args) {\n    super(...args);\n\n    this[LOADED] = false;\n\n    Object.defineProperties(this, {\n      loaded: {\n        get: () => this[LOADED],\n      },\n    });\n\n    this._init();\n  }\n\n  _init() {\n    if (this.__initSrc || this.attributes.hasOwnProperty(\"pause\")) {\n      return;\n    }\n\n    let src = this.getAttribute(\"src\");\n\n    if (!src) {\n      return;\n      // throw `The ${this.tagName.toLowerCase()} element requires the src attribut `;\n    }\n    this.__initSrc = src;\n\n    src = new URL(src, location.href).href;\n    Object.defineProperties(this, {\n      src: {\n        configurable: true,\n        value: src,\n      },\n    });\n\n    const [url, ...params] = src.split(\" \");\n\n    agent(url, {\n      element: this,\n      params,\n    });\n  }\n\n  attributeChangedCallback(name, oldValue, newValue) {\n    if (name === \"src\") {\n      if (newValue && oldValue === null) {\n        this._init();\n      } else if (this.__initSrc && oldValue && newValue !== this.__initSrc) {\n        console.warn(\n          `${this.tagName.toLowerCase()} change src is invalid, only the first change will be loaded`\n        );\n        this.setAttribute(\"src\", this.__initSrc);\n      }\n    } else if (name === \"pause\" && newValue === null) {\n      this._init();\n    }\n  }\n\n  static get observedAttributes() {\n    return [\"src\", \"pause\"];\n  }\n}\n\nclass LM extends LoadModule {\n  constructor(...args) {\n    super(...args);\n  }\n}\n\ncustomElements.define(\"load-module\", LoadModule);\ncustomElements.define(\"l-m\", LM);\n","import lm from \"./main.mjs\";\nimport \"./component.mjs\";\n\nif (typeof window !== \"undefined\") {\n  window.lm = lm;\n}\n\nexport default lm;\n"],"names":["processor","use","name","handler","Function","Array","forEach","push","url","params","d","URL","includes","import","origin","pathname","fetch","then","e","text","async","json","data","arrayBuffer","module","WebAssembly","compile","Instance","exports","LOADED","Symbol","agent","opts","urldata","type","slice","lastIndexOf","tasks","f","temp","undefined","element","event","Event","dispatchEvent","lm","meta","document","location","href","ourl","reurl","split","resolve","currentUrl","createLoad","Object","assign","LoadModule","HTMLElement","constructor","args","super","this","defineProperties","loaded","get","_init","__initSrc","attributes","hasOwnProperty","src","getAttribute","configurable","value","attributeChangedCallback","oldValue","newValue","console","warn","tagName","toLowerCase","setAttribute","observedAttributes","customElements","define","window"],"mappings":";AAAO,MAAMA,EAAY,CAAA,EAEZC,EAAM,CAACC,EAAMC,KAMxB,GALID,aAAgBE,WAClBD,EAAUD,EACVA,EAAO,CAAC,KAAM,QAGZA,aAAgBG,MAKlB,YAJAH,EAAKI,SAASJ,KACEF,EAAUE,KAAUF,EAAUE,GAAQ,KAC9CK,KAAKJ,EAAQ,KAKTH,EAAUE,KAAUF,EAAUE,GAAQ,KAC9CK,KAAKJ,EAAQ,EAGrBF,EAAI,CAAC,MAAO,OAAO,EAAGO,MAAKC,aACzB,MAAMC,EAAI,IAAIC,IAAIH,GAClB,OAAIC,EAAOG,SAAS,WACXC,OAAOL,GAETK,OAAO,GAAGH,EAAEI,SAASJ,EAAEK,WAAW,IAG3Cd,EAAI,CAAC,MAAO,SAAS,EAAGO,SACfQ,MAAMR,GAAKS,MAAMC,GAAMA,EAAEC,WAGlClB,EAAI,QAAQmB,OAASZ,SACZQ,MAAMR,GAAKS,MAAMC,GAAMA,EAAEG,WAGlCpB,EAAI,QAAQmB,OAASZ,UACnB,MAAMc,QAAaN,MAAMR,GAAKS,MAAMC,GAAMA,EAAEK,gBAEtCC,QAAeC,YAAYC,QAAQJ,GAGzC,OAFiB,IAAIG,YAAYE,SAASH,GAE1BI,OAAO,ICzClB,MAAMC,EAASC,OAAO,UAyBhBC,EAAQX,MAAOZ,EAAKwB,KAC/B,MAAMC,EAAU,IAAItB,IAAIH,IAClBO,SAAEA,GAAakB,EAEfC,EAAOnB,EAASoB,MAAgD,GAAxCpB,EAASqB,YAAY,KAAO,IAAO,IAEjE,IAAId,EAEJ,MAAMe,EAAQrC,EAAUkC,GAExB,GAAIG,EACF,IAAK,IAAIC,KAAKD,EAAO,CACnB,MAAME,QAAaD,EAAE,CACnB9B,MACAc,UACGU,SAGIQ,IAATD,IAAuBjB,EAAOiB,EAC/B,MAEDjB,EAAON,MAAMR,GAGf,GAAIwB,GAAQA,EAAKS,QAAS,CACxB,MAAMA,QAAEA,GAAYT,EACpBS,EAAQZ,IAAU,EAClB,MAAMa,EAAQ,IAAIC,MAAM,QACxBF,EAAQG,cAAcF,EACvB,CAED,OAAOpB,CAAI,EAGE,SAASuB,EAAGC,GACzB,MA1DiB,CAACA,IACbA,IACHA,EAAO,CACLtC,IAAKuC,SAASC,SAASC,OAGbC,IACZ,IAAIC,EAAQ,GACZ,MAAO3C,KAAQC,GAAUyC,EAAKE,MAAM,KAEpC,GAAIN,EAAKO,QACPF,EAAQL,EAAKO,QAAQ7C,OAChB,CACL,MAAM8C,EAAa,IAAI3C,IAAImC,EAAKtC,KAEhC2C,EADoB,IAAIxC,IAAIH,EAAK8C,GACbL,IACrB,CAED,OAAOlB,EAAMoB,EAAO,CAAE1C,UAAS,GAwC1B8C,CAAWT,EACpB,CAEAU,OAAOC,OAAOZ,EAAI,CAChB5C,QC/DF,MAAMyD,UAAmBC,YACvBC,eAAeC,GACbC,SAASD,GAETE,KAAKlC,IAAU,EAEf2B,OAAOQ,iBAAiBD,KAAM,CAC5BE,OAAQ,CACNC,IAAK,IAAMH,KAAKlC,MAIpBkC,KAAKI,OACN,CAEDA,QACE,GAAIJ,KAAKK,WAAaL,KAAKM,WAAWC,eAAe,SACnD,OAGF,IAAIC,EAAMR,KAAKS,aAAa,OAE5B,IAAKD,EACH,OAGFR,KAAKK,UAAYG,EAEjBA,EAAM,IAAI5D,IAAI4D,EAAKvB,SAASC,MAAMA,KAClCO,OAAOQ,iBAAiBD,KAAM,CAC5BQ,IAAK,CACHE,cAAc,EACdC,MAAOH,KAIX,MAAO/D,KAAQC,GAAU8D,EAAInB,MAAM,KAEnCrB,EAAMvB,EAAK,CACTiC,QAASsB,KACTtD,UAEH,CAEDkE,yBAAyBzE,EAAM0E,EAAUC,GAC1B,QAAT3E,EACE2E,GAAyB,OAAbD,EACdb,KAAKI,QACIJ,KAAKK,WAAaQ,GAAYC,IAAad,KAAKK,YACzDU,QAAQC,KACN,GAAGhB,KAAKiB,QAAQC,6EAElBlB,KAAKmB,aAAa,MAAOnB,KAAKK,YAEd,UAATlE,GAAiC,OAAb2E,GAC7Bd,KAAKI,OAER,CAEUgB,gCACT,MAAO,CAAC,MAAO,QAChB,EASHC,eAAeC,OAAO,cAAe3B,GACrC0B,eAAeC,OAAO,MAPtB,cAAiB3B,EACfE,eAAeC,GACbC,SAASD,EACV,IClEmB,oBAAXyB,SACTA,OAAOzC,GAAKA"}