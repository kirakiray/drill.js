//! drill.js - v5.3.2 https://github.com/kirakiray/drill.js  (c) 2018-2023 YAO
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t="undefined"!=typeof globalThis?globalThis:t||self).lm=e()}(this,(function(){"use strict";class t{constructor(){this._middlewares=new Map}use(t){const e=Math.random().toString(32).slice(2);return this._middlewares.set(e,t),e}unuse(t){return this._middlewares.delete(t)}async run(t){let e=-1;const s=Array.from(this._middlewares.values()),n=async()=>{e++,e<s.length&&await s[e](t,n)};await n()}}const e={},s=(s,n)=>{(e[s]||(e[s]=new t)).use(n)},n=(t,e)=>{t instanceof Function&&(e=t,t=["js","mjs"]),t instanceof Array?t.forEach((t=>{s(t,e)})):s(t,e)};n(["mjs","js"],(async(t,e)=>{if(!t.result){const{url:e,params:s}=t,n=new URL(e),r=/^blob:/.test(e)||/^data:/.test(e);try{r||s.includes("-direct")?t.result=await import(e):t.result=await import(`${n.origin}${n.pathname}`)}catch(s){const n=i(`Failed to load module ${t.realUrl||e}`,s);throw r&&console.log("Failed to load module:",t),n}}await e()})),n(["txt","html","htm"],(async(t,e)=>{if(!t.result){const{url:e}=t;let s;try{s=await fetch(e)}catch(t){throw i(`Load ${e} failed`,t)}if(!/^2.{2}$/.test(s.status))throw new Error(`Load ${e} failed: status code ${s.status}`);t.result=await s.text()}await e()})),n("json",(async(t,e)=>{if(!t.result){const{url:e}=t;t.result=await fetch(e).then((t=>t.json()))}await e()})),n("wasm",(async(t,e)=>{if(!t.result){const{url:e}=t,s=await fetch(e).then((t=>t.arrayBuffer())),n=await WebAssembly.compile(s),i=new WebAssembly.Instance(n);t.result=i.exports}await e()})),n("css",(async(t,e)=>{if(!t.result){const{url:e,element:s}=t;if(s){const t=document.createElement("link");t.rel="stylesheet",t.href=e;const n=s.getRootNode();let i;n===document?n.head.append(t):n.appendChild(t),s.addEventListener("disconnected",i=e=>{t.remove(),s.removeEventListener("disconnected",i)})}else t.result=await fetch(e).then((t=>t.text()))}await e()}));const i=(t,e)=>{const s=new Error(`${t} \n  ${e.toString()}`);return s.error=e,s},r={};const a=Symbol("loaded"),o=async(t,s)=>{const n=new URL(t),{pathname:i}=n;let r,o=null;s.params&&s.params.forEach((t=>{/^\..+/.test(t)?r=t.replace(/^\.(.+)/,"$1"):/^\-\-real/.test(t)&&(o=t.replace(/^\-\-real\:/,""))})),r||(r=i.slice(2+(i.lastIndexOf(".")-1>>>0)));const l={url:t,result:null,realUrl:o,...s},c=e[r];if(c?await c.run(l):l.result=fetch(t),s&&s.element){const{element:t}=s;t[a]=!0;const e=new Event("load");t.dispatchEvent(e)}return s.params&&s.params.includes("-ctx")?l:l.result};function l(t,e){return((t,e)=>(t||(t={url:document.location.href}),s=>{let n="",[i,...a]=s.split(" ");const l=i.split("/");if(/^@.+/.test(l[0])){if(!r[l[0]])throw`Can't find an alias address: '${l[0]}'`;l[0]=r[l[0]],i=l.join("/")}if(t.resolve)n=t.resolve(i);else{const e=new URL(t.url);n=new URL(i,e).href}return o(n,{params:a,...e})}))(t,e)}Object.assign(l,{use:n});class c extends HTMLElement{constructor(...t){super(...t),this[a]=!1,Object.defineProperties(this,{loaded:{get:()=>this[a]}}),this._init()}_init(){if(this.__initSrc||this.attributes.hasOwnProperty("pause"))return;let t=this.getAttribute("src");if(!t)return;this.__initSrc=t;lm(void 0,{element:this})(t),Object.defineProperties(this,{src:{configurable:!0,value:t}})}connectedCallback(){const t=new CustomEvent("connected");t.root=this._root=this.getRootNode(),this.dispatchEvent(t)}disconnectedCallback(){const t=new CustomEvent("disconnected");t.root=this._root,delete this._root,this.dispatchEvent(t)}attributeChangedCallback(t,e,s){"src"===t?s&&null===e?this._init():this.__initSrc&&e&&s!==this.__initSrc&&(console.warn(`${this.tagName.toLowerCase()} change src is invalid, only the first change will be loaded`),this.setAttribute("src",this.__initSrc)):"pause"===t&&null===s&&this._init()}static get observedAttributes(){return["src","pause"]}}class d extends c{constructor(...t){super(...t)}}const u=()=>{customElements.define("load-module",c),customElements.define("l-m",d),window.removeEventListener("load",u)};return"complete"===document.readyState?u():window.addEventListener("load",u),l.config=async function(t){const{alias:e}=t;return e&&Object.entries(e).forEach((([t,e])=>{if(/^@.+/.test(t)){if(r[t])throw`Alias already exists: '${t}'`;if(/^\./.test(e))throw`The address does not match the specification, please use '/' or or the beginning of the protocol: '${e}'`;r[t]=e}})),!0},Object.freeze(l),window.lm=l,l}));
//# sourceMappingURL=drill.min.js.map
