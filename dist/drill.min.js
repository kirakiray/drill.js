//! drill.js - v5.3.7 https://github.com/kirakiray/drill.js  (c) 2018-2024 YAO
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t="undefined"!=typeof globalThis?globalThis:t||self).lm=e()}(this,(function(){"use strict";class t{constructor(){this._middlewares=new Map}use(t){const e=Math.random().toString(32).slice(2);return this._middlewares.set(e,t),e}unuse(t){return this._middlewares.delete(t)}async run(t){let e=-1;const s=Array.from(this._middlewares.values()),n=async()=>{e++,e<s.length&&await s[e](t,n)};await n()}}const e=new Map,s=async(t,s)=>{const n=new URL(t),a=s.includes("-direct")?t:`${n.origin}${n.pathname}`;let i=e.get(a);i||(i=fetch(a),e.set(a,i));return(await i).clone()},n={},a=(e,s)=>{(n[e]||(n[e]=new t)).use(s)},i=(t,e)=>{t instanceof Function&&(e=t,t=["js","mjs"]),t instanceof Array?t.forEach((t=>{a(t,e)})):a(t,e)};i(["mjs","js"],(async(t,e)=>{if(!t.result){const{url:e,params:s}=t,n=new URL(e),a=/^blob:/.test(e)||/^data:/.test(e);try{a||s.includes("-direct")?t.result=await import(e):t.result=await import(`${n.origin}${n.pathname}`)}catch(s){const n=r(`Failed to load module ${t.realUrl||e}`,s);throw a&&console.log("Failed to load module:",t),n}}await e()})),i(["txt","html","htm"],(async(t,e)=>{if(!t.result){const{url:e,params:n}=t;let a;try{a=await s(e,n)}catch(t){throw r(`Load ${e} failed`,t)}if(!/^2.{2}$/.test(a.status))throw new Error(`Load ${e} failed: status code ${a.status}`);t.result=await a.text()}await e()})),i("json",(async(t,e)=>{if(!t.result){const{url:e,params:n}=t;t.result=await s(e,n).then((t=>t.json()))}await e()})),i("wasm",(async(t,e)=>{if(!t.result){const{url:e,params:n}=t,a=await s(e,n).then((t=>t.arrayBuffer())),i=await WebAssembly.compile(a),r=new WebAssembly.Instance(i);t.result=r.exports}await e()})),i("css",(async(t,e)=>{if(!t.result){const{url:e,element:n,params:a}=t;if(n){const t=document.createElement("link");t.rel="stylesheet",t.href=e;const s=n.getRootNode();let a;s===document?s.head.append(t):s.appendChild(t),n.addEventListener("disconnected",a=e=>{t.remove(),n.removeEventListener("disconnected",a)})}else t.result=await s(e,a).then((t=>t.text()))}await e()}));const r=(t,e)=>new Error(`${t} \n  ${e.toString()}`,{cause:e}),o={};const l=(t,e)=>{if(t.startsWith("http://")||t.startsWith("https://"))return t;const[s,...n]=t.split(" ");let a=s;if(/^@/.test(s)){const[t,...e]=s.split("/");if(!o[t])throw new Error(`No alias defined ${t}`);a=[o[t].replace(/\/$/,""),...e].join("/")}if("undefined"!=typeof location){const t=e?new URL(e,location.href):location.href;a=new URL(a,t).href}return n.length?`${a} ${n.join(" ")}`:a},c=Symbol("loaded"),d=async(t,e)=>{const s=new URL(t),{pathname:a}=s;let i,r=null;e.params&&e.params.forEach((t=>{/^\..+/.test(t)?i=t.replace(/^\.(.+)/,"$1"):/^\-\-real/.test(t)&&(r=t.replace(/^\-\-real\:/,""))})),i||(i=a.slice(2+(a.lastIndexOf(".")-1>>>0)));const o={url:t,result:null,realUrl:r,...e},l=n[i];if(l)await l.run(o);else{const e=await fetch(t),s=e.headers.get("Content-Type"),a=[["application/javascript","js"],["application/json","json"],["text/html","html"],["text/xml","xml"]].find((t=>s.includes(t[0])));let i;a&&(i=n[a[1]]),i?await i.run(o):o.result=e}if(e&&e.element){const{element:t}=e;t[c]=!0;const s=new Event("load");t.dispatchEvent(s)}return e.params&&e.params.includes("-ctx")?o:o.result};function u(t,e){return((t,e)=>(t||(t={url:document.location.href}),s=>{let[n,...a]=s.split(" ");const i=l(n,t.url);return d(i,{params:a,...e})}))(t,e)}Object.assign(u,{use:i});class h extends HTMLElement{constructor(...t){super(...t),this[c]=!1,Object.defineProperties(this,{loaded:{get:()=>this[c]}}),this._init()}_init(){if(this.__initSrc||this.attributes.hasOwnProperty("pause"))return;let t=this.getAttribute("src");if(!t)return;this.__initSrc=t;lm(void 0,{element:this})(t),Object.defineProperties(this,{src:{configurable:!0,value:t}})}connectedCallback(){const t=new CustomEvent("connected");t.root=this._root=this.getRootNode(),this.dispatchEvent(t)}disconnectedCallback(){const t=new CustomEvent("disconnected");t.root=this._root,delete this._root,this.dispatchEvent(t)}attributeChangedCallback(t,e,s){"src"===t?s&&null===e?this._init():this.__initSrc&&e&&s!==this.__initSrc&&(console.warn(`${this.tagName.toLowerCase()} change src is invalid, only the first change will be loaded`),this.setAttribute("src",this.__initSrc)):"pause"===t&&null===s&&this._init()}static get observedAttributes(){return["src","pause"]}}class m extends h{constructor(...t){super(...t)}}const f=()=>{customElements.define("load-module",h),customElements.define("l-m",m),window.removeEventListener("load",f)};return"complete"===document.readyState?f():window.addEventListener("load",f),u.config=async function(t){const{alias:e}=t;return e&&Object.entries(e).forEach((([t,e])=>{if(/^@.+/.test(t)){if(o[t])throw new Error(`Alias already exists: '${t}'`);if(/^\./.test(e))throw new Error(`The address does not match the specification, please use '/' or or the beginning of the protocol: '${e}'`);o[t]=e}})),!0},u.path=l,Object.freeze(u),window.lm=u,u}));
//# sourceMappingURL=drill.min.js.map
